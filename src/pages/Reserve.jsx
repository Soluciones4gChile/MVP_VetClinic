import React,{useState} from 'react';import SlotPicker from '../components/SlotPicker.jsx';import CheckoutMock from '../components/CheckoutMock.jsx';import { uid, createReservation, tokenFor } from '../storage';import { money } from '../utils';import { useNavigate } from 'react-router-dom'
const SPECS=[{id:'sp1',name:'Dra. Gómez — Cardio',price:35000},{id:'sp2',name:'Dr. Pérez — Trauma',price:38000},{id:'sp3',name:'Dra. Silva — Derma',price:30000}]
export default function Reserve(){const [email,setEmail]=useState('');const [spec,setSpec]=useState('');const [slot,setSlot]=useState('');const [open,setOpen]=useState(false);const nav=useNavigate();const s=SPECS.find(x=>x.id===spec);const price=s? s.price:0;const deposit=Math.round(price*0.5);function checkout(e){e.preventDefault();if(!email||!spec||!slot)return alert('Completa todo');setOpen(true)}function onResult(ok){setOpen(false);if(!ok)return alert('Pago fallido');const id=uid();createReservation({id,email,specialistId:spec,specialistName:s.name,datetimeISO:slot,price,deposit,status:'Activa'});const t=tokenFor(email);if(confirm('Pago OK. ¿Ver “Mis reservas”?')) nav('/m/'+t)}return(<div className='card'><h2>Reservar</h2><form className='row' onSubmit={checkout} style={{flexDirection:'column',gap:12}}><input type='email' placeholder='tucorreo@ejemplo.cl' value={email} onChange={e=>setEmail(e.target.value)} /><select value={spec} onChange={e=>setSpec(e.target.value)}><option value='' disabled>Especialista</option>{SPECS.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}</select><SlotPicker value={slot} onChange={setSlot}/><div className='row' style={{justifyContent:'space-between'}}><small>Valor: <b>{money(price)}</b> · Anticipo 50%: <b>{money(deposit)}</b></small><button className='btn'>Pagar anticipo</button></div></form><CheckoutMock open={open} amount={deposit} onClose={()=>setOpen(false)} onResult={onResult}/></div>)}
const R='reservations_v1',T='magic_tokens_v1';const load=k=>JSON.parse(localStorage.getItem(k)||'null')||{};const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));export const uid=()=>Math.random().toString(36).slice(2)+Date.now().toString(36);export function createReservation(r){const all=Object.values(load(R));all.push(r);const byId={};all.forEach(x=>byId[x.id]=x);save(R,byId)}export function byEmail(email){return Object.values(load(R)).filter(x=>x.email.toLowerCase()===email.toLowerCase())}export function setStatus(id,status,extra={}){const all=load(R);if(all[id]){all[id]={...all[id],status,...extra};save(R,all)}}export function tokenFor(email){const t=uid();const all=load(T);all[t]={email,at:new Date().toISOString()};save(T,all);return t}export function emailForToken(t){return load(T)[t]?.email||null}export function updateEmail(oldE,newE){const all=Object.values(load(R)).map(x=>x.email.toLowerCase()===oldE.toLowerCase()?({...x,email:newE}):x);const byId={};all.forEach(x=>byId[x.id]=x);save(R,byId)}